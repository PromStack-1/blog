---
import { getCollection } from 'astro:content';
import BaseHead from '../../components/BaseHead.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import FormattedDate from '../../components/FormattedDate.astro';
import { SITE_DESCRIPTION, SITE_TITLE } from '../../consts';

const posts = (await getCollection('blog')).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);

const featuredPost = posts[0];
const otherPosts = posts.slice(1);
---

<!doctype html>
<html lang="ko">
	<head>
		<BaseHead title={`블로그 | ${SITE_TITLE}`} description={SITE_DESCRIPTION} />
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
	</head>
	<body>
		<Header />
		
		<!-- Animated Background -->
		<div class="bg-glow glow-1"></div>
		<div class="bg-glow glow-2"></div>
		
		<main class="blog-wrapper">
			<header class="page-header">
				<div class="header-content">
					<p class="page-label"><span>✦</span> Knowledge Base</p>
					<h1 class="page-title">Insights & <span class="gradient-text">Engineering</span></h1>
					<p class="page-desc">AI, 프롬프트 엔지니어링, 그리고 개발에 대한 깊이 있는 이야기</p>
				</div>
			</header>

			{featuredPost && (
				<section class="featured">
					<a href={`/blog/${featuredPost.id}/`} class="featured-card">
						<div class="featured-image">
							{featuredPost.data.heroImage && (
								<img src={typeof featuredPost.data.heroImage === 'string' ? featuredPost.data.heroImage : featuredPost.data.heroImage.src} alt="" />
							)}
							<div class="featured-overlay"></div>
						</div>
						<div class="featured-content">
							<div class="featured-badge">Featured Post</div>
							<h2 class="featured-title">{featuredPost.data.title}</h2>
							<p class="featured-excerpt">{featuredPost.data.description}</p>
							<div class="featured-footer">
								<span class="featured-meta">
									<FormattedDate date={featuredPost.data.pubDate} />
								</span>
								<span class="read-more">Read Article →</span>
							</div>
						</div>
					</a>
				</section>
			)}

			<div class="section-divider"></div>

			<section class="posts-section">
				<div class="posts-header">
					<h2>Latest Updates</h2>
					<div class="posts-count">{otherPosts.length} Articles</div>
				</div>
				<div class="posts-grid">
					{otherPosts.map((post) => (
						<a href={`/blog/${post.id}/`} class="post-card">
							<div class="post-image">
								{post.data.heroImage && (
									<img src={typeof post.data.heroImage === 'string' ? post.data.heroImage : post.data.heroImage.src} alt="" />
								)}
							</div>
							<div class="post-content">
								<span class="post-meta"><FormattedDate date={post.data.pubDate} /></span>
								<h3 class="post-title">{post.data.title}</h3>
								<p class="post-excerpt">{post.data.description}</p>
								<div class="post-footer">
									<span class="read-more-sm">Read more</span>
									<span class="arrow">→</span>
								</div>
							</div>
						</a>
					))}
				</div>
			</section>
		</main>
		<Footer />
	</body>
</html>

<style is:global>
	:root {
		--bg: #050505;
		--bg-card: #111111;
		--bg-elevated: #161616;
		--text: #ffffff;
		--text-secondary: #a1a1aa;
		--text-muted: #52525b;
		--accent: #6366f1;
		--accent-glow: rgba(99, 102, 241, 0.15);
		--border: rgba(255, 255, 255, 0.08);
		--border-hover: rgba(255, 255, 255, 0.15);
	}

	* { margin: 0; padding: 0; box-sizing: border-box; }

	body {
		background: var(--bg);
		color: var(--text);
		font-family: 'Inter', -apple-system, sans-serif;
		overflow-x: hidden;
	}

	/* Animated Background */
	.bg-glow {
		position: fixed;
		border-radius: 50%;
		filter: blur(100px);
		opacity: 0.3;
		pointer-events: none;
		z-index: -1;
	}
	.glow-1 {
		width: 600px; height: 600px;
		background: radial-gradient(circle, #4f46e5, transparent 70%);
		top: -100px; right: -100px;
		animation: float1 20s ease-in-out infinite;
	}
	.glow-2 {
		width: 500px; height: 500px;
		background: radial-gradient(circle, #db2777, transparent 70%);
		bottom: 100px; left: -100px;
		animation: float2 25s ease-in-out infinite;
	}
	@keyframes float1 {
		0%, 100% { transform: translate(0, 0); }
		50% { transform: translate(-30px, 30px); }
	}
	@keyframes float2 {
		0%, 100% { transform: translate(0, 0); }
		50% { transform: translate(30px, -30px); }
	}

	.blog-wrapper {
		max-width: 1400px;
		margin: 0 auto;
		padding: 6rem 3rem;
		position: relative;
		z-index: 1;
	}

	/* Header */
	.page-header {
		margin-bottom: 5rem;
		text-align: center;
	}
	.page-label {
		display: inline-flex;
		align-items: center;
		gap: 0.5rem;
		font-family: 'JetBrains Mono', monospace;
		font-size: 0.75rem;
		font-weight: 600;
		letter-spacing: 0.2em;
		text-transform: uppercase;
		color: var(--accent);
		margin-bottom: 1.5rem;
	}
	.page-title {
		font-size: clamp(3rem, 6vw, 4.5rem);
		font-weight: 800;
		letter-spacing: -0.04em;
		margin-bottom: 1rem;
		line-height: 1.1;
	}
	.gradient-text {
		background: linear-gradient(135deg, #fff 0%, #818cf8 100%);
		-webkit-background-clip: text;
		-webkit-text-fill-color: transparent;
	}
	.page-desc {
		font-size: 1.25rem;
		color: var(--text-secondary);
		max-width: 600px;
		margin: 0 auto;
		line-height: 1.6;
	}

	/* Featured Card */
	.featured { margin-bottom: 6rem; }
	.featured-card {
		display: grid;
		grid-template-columns: 1.3fr 0.7fr;
		gap: 3rem;
		padding: 2.5rem;
		background: rgba(17, 17, 17, 0.6);
		border: 1px solid var(--border);
		border-radius: 24px;
		text-decoration: none;
		backdrop-filter: blur(20px);
		transition: all 0.4s ease;
	}
	.featured-card:hover {
		border-color: rgba(99, 102, 241, 0.3);
		transform: translateY(-4px);
		box-shadow: 0 20px 40px rgba(0,0,0,0.2);
	}
	.featured-image {
		position: relative;
		border-radius: 16px;
		overflow: hidden;
		aspect-ratio: 16/9;
		background: var(--bg-elevated);
	}
	.featured-image img {
		width: 100%; height: 100%;
		object-fit: cover;
		transition: transform 0.6s ease;
	}
	.featured-card:hover .featured-image img { transform: scale(1.05); }
	
	.featured-content {
		display: flex;
		flex-direction: column;
		justify-content: center;
	}
	.featured-badge {
		display: inline-block;
		font-family: 'JetBrains Mono', monospace;
		font-size: 0.75rem;
		font-weight: 600;
		padding: 0.35rem 0.85rem;
		background: var(--accent);
		color: white;
		border-radius: 100px;
		width: fit-content;
		margin-bottom: 1.5rem;
	}
	.featured-title {
		font-size: 2.5rem;
		font-weight: 800;
		line-height: 1.2;
		color: var(--text);
		margin-bottom: 1rem;
		letter-spacing: -0.02em;
	}
	.featured-excerpt {
		font-size: 1.125rem;
		color: var(--text-secondary);
		line-height: 1.6;
		margin-bottom: 2rem;
	}
	.featured-footer {
		margin-top: auto;
		display: flex;
		align-items: center;
		justify-content: space-between;
		padding-top: 1.5rem;
		border-top: 1px solid var(--border);
	}
	.featured-meta, .read-more {
		font-family: 'JetBrains Mono', monospace;
		font-size: 0.8125rem;
		font-weight: 600;
	}
	.featured-meta { color: var(--text-muted); text-transform: uppercase; }
	.read-more { color: var(--accent); display: flex; align-items: center; gap: 0.5rem; }

	/* Section Divider */
	.section-divider {
		width: 100%; height: 1px;
		background: linear-gradient(90deg, transparent, var(--border), transparent);
		margin: 4rem 0;
	}

	/* Posts Grid */
	.posts-header {
		display: flex;
		justify-content: space-between;
		align-items: flex-end;
		margin-bottom: 3rem;
	}
	.posts-header h2 {
		font-size: 2rem;
		font-weight: 800;
		letter-spacing: -0.02em;
	}
	.posts-count {
		font-family: 'JetBrains Mono', monospace;
		font-size: 0.875rem;
		color: var(--text-muted);
	}

	.posts-grid {
		display: grid;
		grid-template-columns: repeat(3, 1fr);
		gap: 2rem;
	}
	.post-card {
		display: flex;
		flex-direction: column;
		background: var(--bg-card);
		border: 1px solid var(--border);
		border-radius: 20px;
		overflow: hidden;
		text-decoration: none;
		transition: all 0.3s ease;
	}
	.post-card:hover {
		transform: translateY(-6px);
		border-color: var(--border-hover);
	}
	.post-image {
		aspect-ratio: 16/10;
		background: var(--bg-elevated);
		overflow: hidden;
	}
	.post-image img {
		width: 100%; height: 100%;
		object-fit: cover;
		transition: transform 0.5s ease;
	}
	.post-card:hover .post-image img { transform: scale(1.05); }
	
	.post-content { padding: 1.75rem; flex: 1; display: flex; flex-direction: column; }
	.post-meta {
		font-family: 'JetBrains Mono', monospace;
		font-size: 0.75rem;
		color: var(--text-muted);
		text-transform: uppercase;
		margin-bottom: 0.75rem;
		display: block;
	}
	.post-title {
		font-size: 1.25rem;
		font-weight: 700;
		color: var(--text);
		margin-bottom: 0.75rem;
		line-height: 1.4;
	}
	.post-excerpt {
		font-size: 0.9375rem;
		color: var(--text-secondary);
		line-height: 1.6;
		margin-bottom: 1.5rem;
		display: -webkit-box;
		-webkit-line-clamp: 2;
		-webkit-box-orient: vertical;
		overflow: hidden;
	}
	.post-footer {
		margin-top: auto;
		display: flex;
		align-items: center;
		justify-content: space-between;
		font-size: 0.8125rem;
		font-weight: 600;
		color: var(--text-muted);
	}
	.post-card:hover .post-footer { color: var(--accent); }
	.arrow { transition: transform 0.3s ease; }
	.post-card:hover .arrow { transform: translateX(4px); }

	/* Responsive */
	@media (max-width: 1200px) {
		.featured-card { grid-template-columns: 1fr; }
		.featured-content { order: 2; }
		.featured-image { order: 1; }
		.posts-grid { grid-template-columns: repeat(2, 1fr); }
	}
	@media (max-width: 768px) {
		.blog-wrapper { padding: 4rem 1.5rem; }
		.posts-grid { grid-template-columns: 1fr; }
		.page-title { font-size: 2.5rem; }
	}
</style>
